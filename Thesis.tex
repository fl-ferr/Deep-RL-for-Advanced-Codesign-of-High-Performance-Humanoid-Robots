% A LaTeX template for MSc Thesis submissions to 
% Politecnico di Milano (PoliMi) - School of Industrial and Information Engineering
%
% S. Bonetti, A. Gruttadauria, G. Mescolini, A. Zingaro
% e-mail: template-tesi-ingind@polimi.it
%
% Last Revision: October 2021
%
% Copyright 2021 Politecnico di Milano, Italy. NC-BY

\documentclass{Configuration_Files/PoliMi3i_thesis}

%------------------------------------------------------------------------------
%	REQUIRED PACKAGES AND  CONFIGURATIONS
%------------------------------------------------------------------------------

% CONFIGURATIONS
\usepackage{parskip} % For paragraph layout
\usepackage{setspace} % For using single or double spacing
\usepackage{emptypage} % To insert empty pages
\usepackage{multicol} % To write in multiple columns (executive summary)
\setlength\columnsep{15pt} % Column separation in executive summary
\setlength\parindent{0pt} % Indentation
\addtolength{\skip\footins}{5pt} % Footnote separation from text
\setlength{\footnotesep}{2ex} % Footnote separation
\raggedbottom  

% PACKAGES FOR TITLES
\usepackage{titlesec}
% \titlespacing{\section}{left spacing}{before spacing}{after spacing}
\titlespacing{\section}{0pt}{3.3ex}{2ex}
\titlespacing{\subsection}{0pt}{3.3ex}{1.65ex}
\titlespacing{\subsubsection}{0pt}{3.3ex}{1ex}
\usepackage{color}

% PACKAGES FOR LANGUAGE AND FONT
\usepackage[english]{babel} % The document is in English  
\usepackage[utf8]{inputenc} % UTF8 encoding
\usepackage[T1]{fontenc} % Font encoding 
\usepackage[11pt]{moresize} % Big fonts

% PACKAGES FOR IMAGES
\usepackage{graphicx}
\usepackage{transparent} % Enables transparent images
\usepackage{eso-pic} % For the background picture on the title page
\usepackage{subfig} % Numbered and caption subfigures using \subfloat.
\usepackage{tikz} % A package for high-quality hand-made figures.
\usetikzlibrary{}
\graphicspath{{./Images/}} % Directory of the images
\usepackage{caption} % Coloured captions
\usepackage{xcolor} % Coloured captions
\usepackage{amsthm,thmtools,xcolor} % Coloured "Theorem"
\usepackage{float}

% STANDARD MATH PACKAGES
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{mathtools}
\usepackage{bm}
\usepackage[overload]{empheq} % For braced-style systems of equations.
\usepackage{fix-cm} % To override original LaTeX restrictions on sizes

% PACKAGES FOR TABLES
\usepackage{tabularx}
\usepackage{longtable} % Tables that can span several pages
\usepackage{colortbl}

% PACKAGES FOR ALGORITHMS (PSEUDO-CODE)
\usepackage[
  noEnd=true,
  indLines=true,
  italicComments=true,
  rightComments=true,
]{algpseudocodex}
\usepackage{algorithm}

% PACKAGES FOR REFERENCES & BIBLIOGRAPHY
\usepackage[colorlinks=true,linkcolor=black,anchorcolor=black,citecolor=black,filecolor=black,menucolor=black,runcolor=black,urlcolor=webbrown]{hyperref} % Adds clickable links at references
\usepackage[capitalise,noabbrev]{cleveref}
\usepackage[authoryear,square]{natbib} % Square brackets, citing references with numbers, citations sorted by appearance in the text and compressed
\setcitestyle{aysep={,},citesep={,},yysep={,}}
\bibliographystyle{abbrvnat} % You may use a different style adapted to your field

% OTHER PACKAGES
\usepackage{pdfpages} % To include a pdf file
\usepackage{afterpage}
\usepackage{fancyhdr} % For the headers
\fancyhf{}

% Input of configuration file. Do not change config.tex file unless you really know what you are doing. 
\input{Configuration_Files/config}

%----------------------------------------------------------------------------
%	NEW COMMANDS DEFINED
%----------------------------------------------------------------------------
\DeclareMathAlphabet{\mathbbm}{U}{BOONDOX-ds}{m}{n}
%----------------------------------------------------------------------------
%	ADD YOUR PACKAGES (be careful of package interaction)
%----------------------------------------------------------------------------
\usepackage[footnote, smaller]{acronym}
\usepackage{ifthen}
\usepackage{nomencl}
\makenomenclature
\renewcommand\nomgroup[1]{%
\item[\bfseries
\ifthenelse{\equal{#1}{D}}{Rigid Body Dynamics}{%
\ifthenelse{\equal{#1}{R}}{Reinforcement Learning}{%
\ifthenelse{\equal{#1}{M}}{Mathematical Notation}{}}}%
]}
\usepackage[bb=ams]{mathalfa}
\usepackage{booktabs}
\usepackage{soul}
\usepackage{tikz-3dplot}
\usetikzlibrary{positioning}

\usepackage{xspace}
\usepackage[babel=true,tracking=true]{microtype}
\usepackage{calc} 
\usepackage{enumitem}
%----------------------------------------------------------------------------
%	ADD YOUR DEFINITIONS AND COMMANDS (be careful of existing commands)
%----------------------------------------------------------------------------
\definecolor{webgreen}{rgb}{0,.5,0}
\definecolor{webbrown}{rgb}{.6,0,0}
\newcommand{\CarlottaSays}[1]{\textcolor{blue}{\textbf{Carlotta:} #1}}
\newcommand{\StefanoSays}[1]{\textcolor{orange}{\textbf{Stefano:} #1}}
\newcommand{\DanieleSays}[1]{\textcolor{red}{\textbf{Daniele:} #1}}
\newcommand{\SilvioSays}[1]{\textcolor{green}{\textbf{Silvio:} #1}}

\newcommand{\cpp}{C\texttt{++}\xspace}
\newcommand{\jax}{\textsc{jax}~}
\newcommand{\jaxsim}{\textsc{jax}sim~}
%----------------------------------------------------------------------------
%	BEGIN OF YOUR DOCUMENT
%----------------------------------------------------------------------------

\begin{document}

\fancypagestyle{plain}{%
    \fancyhf{} % Clear all header and footer fields
    \fancyhead[RO,RE]{\thepage} %RO=right odd, RE=right even
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0pt}}

%----------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------

\pagestyle{empty} % No page numbers
\frontmatter % Use roman page numbering style (i, ii, iii, iv...) for the preamble pages

\puttitle{
    title=Hardware Accelerated Simulators for Humanoid Robot Codesign via Deep Reinforcement Learning, % Title of the thesis
    name=Filippo Luca Ferretti, % Author Name and Surname
    course=Mechanical Engineering - Ingegneria Meccanica, % Study Programme (in Italian)
    ID  = 994428,  % Student ID number (numero di matricola)
    advisor= {Prof. Francesco Braghin, Dr. Daniele Pucci},% Supervisor name
    coadvisor={Carlotta Sartore, Dr. Stefano Dafarra}, % Co-Supervisor name, remove this line if there is none
    academicyear={2022-23},  % Academic Year
} % These info will be put into your Title page 

%----------------------------------------------------------------------------
%	PREAMBLE PAGES: ABSTRACT (inglese e italiano), EXECUTIVE SUMMARY
%----------------------------------------------------------------------------

\input{Front_Back_Matter/Colophon}

\startpreamble
\setcounter{page}{1} % Set page counter to 1

% ABSTRACT IN ENGLISH
\chapter*{Abstract}
Robot hardware design is often treated as an immutable component in the development of a control strategy.
Moreover, the complexity of the control systems and the computational effort required by certain robot maneuvers, make the control design
challenging, with potential limitation on the adaptability to new scenarios. In order to maximize the performance with respect to a given task,
designing the robot body characteristics together with its control systems in an extensive approach, often referred to as \textit{codesign}, is a promising solution. The use of reinforcement learning as control system is another valid methodology. Yet, it has not been extensively applied to humanoid robotics in a codesign context. Nevertheless, the simulation required during the generation of synthetic data in reinforcement learning phase is computationally expensive, hence it emerges the need for an architecture that allows to speed up the simulation, involving the use of hardware accelerations via simulators that exploit the use of \textit{Graphical Processing Units} (GPUs) and \textit{Tensor Processing Units} (TPUs). This thesis aims at targeting the problem of a synergic design of robots and their control systems. In particular, we focus on the optimization of the electric drives characteristics, which is often crucial in the field of humanoid robotics. To this aim, we first develop an algorithm able to compute the robot dynamics taking into account the presence of the motors, with their gear ratio, inertia and internal friction. Then, we introduce a framework that combines deep reinforcement learning and evolutionary algorithms for the robot codesign, supported by hardware acceleration. Finally, we show that the proposed architecture is able to generate a motor set capable of maximizing the performance of the robot in a simple, yet easily scalable task.
\\
\\
\textbf{Keywords:} codesign, hardware accelerations, reinforcement learning, evolutionary algorithm, forward dynamics % Keywords

% ABSTRACT IN ITALIAN
\chapter*{Abstract in lingua italiana}
La progettazione hardware dei robot è spesso considerata come un componente immutabile nello sviluppo di una architettura di controllo. Inoltre, la complessità dei sistemi di controllo e lo sforzo computazionale richiesto da certi task rendono la progettazione onerosa, con potenziali limitazioni nell'adattabilità a nuovi scenari. Una soluzione promettente al fine di massimizzare le prestazioni rispetto a un dato compito consiste nella progettazione delle caratteristiche morfologiche dei robot insieme ai loro sistemi di controllo in un approccio estensivo, spesso denominato \textit{codesign}. Inoltre, una valida metodologia che non è stata ancora ampiamente applicata alla robotica umanoide in un contesto di codesign è l'uso del reinforcement learning come sistema di controllo. Tuttavia, la simulazione richiesta durante la generazione di dati sintetici nella fase di reinforcement learning è computazionalmente costosa, pertanto emerge la necessità di un'architettura che consenta di velocizzare la simulazione, coinvolgendo l'uso di accelerazioni hardware tramite simulatori che sfruttano le \textit{Unità di Elaborazione Grafica} (GPU) e le \textit{Unità di Elaborazione Tensoriale} (TPU).
Questa tesi si propone di affrontare il problema del design sinergico di robot e dei loro sistemi di controllo. In particolare, ci concentriamo sull'ottimizzazione delle caratteristiche dei motori elettrici, che sono spesso degli elementi cruciali nel campo della robotica umanoide. A tale scopo, sviluppiamo innanzitutto un algoritmo in grado di calcolare la dinamica del robot tenendo conto della presenza dei motori, con il loro rapporto di trasmissione, inerzia e attrito interno. Successivamente, introduciamo un framework per il codesign di robot che combina l'apprendimento per rinforzo con algoritmi genetici, supportato da accelerazione hardware. Infine, dimostriamo che l'architettura proposta è in grado di generare un insieme di motori in grado di massimizzare le prestazioni del robot per un compito semplice, ma facilmente scalabile.
\\
\\
\textbf{Parole chiave:} codesign, accelerazione hardware, apprendimento per rinforzo, algoritmi evolutivi, dinamica diretta % Keywords (italian)

%----------------------------------------------------------------------------
%	LIST OF CONTENTS/FIGURES/TABLES/SYMBOLS
%----------------------------------------------------------------------------

% TABLE OF CONTENTS
\thispagestyle{empty}
\tableofcontents % Table of contents 
\thispagestyle{empty}
\cleardoublepage

\include{Front_Back_Matter/Acronym}
\include{Front_Back_Matter/Symbols}

%-------------------------------------------------------------------------
%	THESIS MAIN TEXT
%-------------------------------------------------------------------------

\addtocontents{toc}{\vspace{2em}} % Add a gap in the Contents, for aesthetics
\mainmatter % Begin numeric (1,2,3...) page numbering

% --------------------------------------------------------------------------
% NUMBERED CHAPTERS % Regular chapters following
% --------------------------------------------------------------------------

\include{Chapters/00-Prologue}

\part{Background}\label{part:background}
\include{Chapters/Background/01-RBDynamics}
\include{Chapters/Background/02-PhysicsSimulators}
\include{Chapters/Background/03-RLGA}

\part{Contributions}\label{part:contributions}
\include{Chapters/Contributions/04-ABA}
\include{Chapters/Contributions/05-CodesignRL}
\include{Chapters/Contributions/06-ResultsDiscussion}
\include{Chapters/Contributions/07-Conclusions}

\include{Chapters/99-Epilogue}
%-------------------------------------------------------------------------
%	BIBLIOGRAPHY
%-------------------------------------------------------------------------

\addtocontents{toc}{\vspace{2em}} % Add a gap in the Contents, for aesthetics
\bibliography{references}

%-------------------------------------------------------------------------
%	APPENDICES
%-------------------------------------------------------------------------

\cleardoublepage
\addtocontents{toc}{\vspace{2em}} % Add a gap in the Contents, for aesthetics
\appendix
\include{Front_Back_Matter/AppendixA}

% LIST OF FIGURES
\listoffigures

% LIST OF TABLES
\listoftables

% LIST OF SYMBOLS
% Write out the List of Symbols in this page
% \chapter*{List of Symbols} % You have to include a chapter for your list of symbols (
% \begin{table}[H]
%     \centering
%     \begin{tabular}{lll}
%         \textbf{Variable} & \textbf{Description} & \textbf{SI unit} \\\hline\\[-9px]
%         $\bm{u}$ & solid displacement & m \\[2px]
%         $\bm{u}_f$ & fluid displacement & m \\[2px]
%     \end{tabular}
% \end{table}

% ACKNOWLEDGEMENTS
\chapter*{Acknowledgements}

This thesis stands as a testament to my tenure as a guest student at the \textit{Artificial Mechanical Intelligence} lab of the \textit{Italian Institute of Technology}. I am thankful to \textit{Daniele} for the opportunity to explore and embrace my true passion in this remarkable field. My heartfelt gratitude goes to \textit{Carlotta} for her extraordinary patience and guidance, allowing me to navigate the complexities and complete this work. Special appreciation extends also to \textit{Silvio} and \textit{Diego} for their unwavering assistance and for instilling in me a passion for robotics. \textit{Roberto}, my constant desk mate, deserves recognition for his constant support throughout this journey. Additionally, I deeply appreciate the guidance and inspiration by \textit{Stefano}, \textit{Saverio}, \textit{Giorgio}, \textit{Ines}, \textit{Davide G.}, \textit{Davide B.}, \textit{Lorenzo M.}, \textit{Lorenzo R.}, \textit{Mohammed}, \textit{Paolo}, \textit{Hosam}, \textit{Carlos}, \textit{Punith}, \textit{Giuseppe}, \textit{Gianluca}, \textit{Cheng}, \textit{Claudia}, \textit{Enrico}, \textit{Antonella}, \textit{Lorenzo F.}, \textit{Filippo}, \textit{Shabarish}, \textit{Akhil}, \textit{Guglielmo}, \textit{Evelyn}, \textit{Giulio}, \textit{Francesca}, \textit{Dario}, \textit{Marco}, \textit{Gabriele}, \textit{Fabio}, and \textit{Affaf}. Each of these people have contributed to the realization of this work and to my formation.

Transitioning from a study of chemistry to a newfound passion for mechanics was thrilling. Moving to Lecco introduced me to an exceptional group of people, among whom I found my closest friends. In particular, the people are worth a huge "thank you". \textit{Lorenzo}, my steadfast companion during the bachelor thesis, lectures, and rain-soaked motorbike tours, stands out. He has been always supporting me, both in academic and personal contexts. Erica, with whom I embarked on brisk ten-kilometer walks and conquered mountains during what were supposed to be "small" hikes. \textit{Saverio}, one of my motorbiking partner, and \textit{Chiara}, with her remarkable baking skills and infectious laughter. \textit{Alessandro}, the mild-mannered individual with a penchant for street rules. And an honorable mention goes to two of my study companions, Manuel and Marco.

Ich möchte meinen Dank auch an die Leute, dass ich im Berlin getroffen hat, aussprechen. Mit diesen Menschen habe ich unvergessliche Momente erlebt, die zu den schönsten meines Lebens gehören. Die Erinnerung an den besten Döner und die großartige Techno-Musik wird stets lebendig bleiben. Insbesondere möchte ich \textit{Dennis}, \textit{Ville}, \textit{Gijs}, \textit{P\v{r}emek}, \textit{Anna}, \textit{Julia}, \textit{Pieter}, \textit{Filip}, \textit{Marte}, \textit{Filip V.B.H.}, \textit{Gian Mario}, \textit{Marco}, \textit{Victoria}, \textit{Agnes}, \textit{Camille} und \textit{Giulia} erwähnen. Mit ihnen fühlte ich mich so wohl und willkommen wie zu Hause.

Per ultimi, ma certamente non per importanza, ai miei genitori e ad \textit{Alessio}, i miei primi sostenitori esprimo il mio sincero ringraziamento. Ai miei genitori, per il loro sostegno incondizionato e per essere stati al mio fianco in ogni situazione e in ogni difficolta. La serenità trasmessami ha fornito le basi che mi hanno permesso di completare questo percorso. Alla mia famiglia, per il loro sostegno e incoraggiamento. E ad Alessio, che nonostante tutto, è stato sempre li a fare il tifo per me. La loro presenza costante e il loro affetto hanno reso questo viaggio ancora più significativo. Grazie di cuore a tutti coloro che hanno contribuito alla realizzazione di questo lungo percorso.

\noindent\textit{Milano, December 2023}

\begin{flushright}
    \hfill F.~L.~F.
\end{flushright}

\cleardoublepage

\end{document}
